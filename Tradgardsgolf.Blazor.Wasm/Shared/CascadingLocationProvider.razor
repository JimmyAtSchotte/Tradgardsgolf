@inject LocationService LocationService

<Loading IsLoading="Location == null">
    <LoadingTemplate>
        <Container Fluid="true">
            <Loading IsLoading="true" LoadingText="Hittar din position..."></Loading>
            <Alert Color="Color.Warning" Display="Display.Always">
                <AlertDescription>För att använda appen så behöver du tillåta att dela din position.</AlertDescription>
            </Alert>
        </Container>
    </LoadingTemplate>
    
    <ChildContent>
        <CascadingValue Value="this">@ChildContent</CascadingValue>
    </ChildContent>
</Loading>

@code {
    [Parameter]
    public RenderFragment ChildContent { get; set; }
    
    [Parameter]
    public Location Location { get; set; }
    
    public event Action<ComponentBase> LocationChanged;
    
    protected override async Task OnInitializedAsync()
    {
        await LocationService.WatchLocation(LocationCallback);
    }
 
    private void LocationCallback(Location location)
    {
        if(Location?.Latitude == location.Latitude && 
           Location?.Longitude == location.Longitude)
            return;

        Location = location;
        LocationChanged?.Invoke(this);
        StateHasChanged();
    }
}